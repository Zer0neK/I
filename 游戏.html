<!doctype html>
<html lang="cn">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:description" content="0_o">
  <meta name="theme-color" data-react-helmet="true" content=
  "#000000">
  <title>剑客</title>
  <link rel="icon" type="image/png" href="https://tr.rbxcdn.com/180DAY-df8e7a1023411583234cb7b335f4babc/150/150/Image/Webp/noFilter">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="bg-sheen"></div>
  <video id="bg-video" class="bg-video" autoplay loop muted playsinline></video>
  <canvas id="snow-canvas" class="snow-canvas"></canvas>
  <header class="topbar glass">
    <div class="brand">
      <div class="brand-icon" aria-hidden="true"></div>
      <div class="brand-text">
        <span class="brand-name">剑客</span>
      </div>
    </div>
    <nav class="nav-links" aria-label="main navigation">
      <a href="SG.html">主页</a>
      <a href="游戏.html">游戏 制作中...</a>
      <a href="联系.html">联系</a>
      <a href="关于.html">关于</a>
    </nav>
    <div class="nav-actions">
      <a class="btn primary" href="购买.html">购买剑客</a>
      <a class="btn ghost" href="购买.html#购买规则">购买必看</a>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="section-header">
        <div>
          <h2>支持的游戏</h2>
        </div>
      </div>
      <div class="games-grid" id="games-grid">
        <div class="loading-state">loading games</div>
      </div>
    </section>
  </main>

  <div class="game-features-modal glass" id="features-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-game-title">features</h2>
        <button class="modal-close" onclick="closeGameFeatures()">×</button>
      </div>
      <div class="modal-body" id="modal-body">
      </div>
    </div>
  </div>

  <footer class="footer glass">
    <div class="footer-brand">
      <div class="brand-icon small" aria-hidden="true"></div>
      <span>剑客</span>
    </div>
    <div class="footer-meta">
      <span>jianke.lol 2026-2036</span>
    </div>
  </footer>
  <script src="app.js"></script>
  <script>
    const gameFeatures = {
      flick: {
        combat: [
          "silent aim",
          "aimbot",
          "trigger bot",
          "recoil multiplier",
          "fire rate multiplier"
        ],
        visual: [
          "esp",
          "chams",
          "tracers"
        ],
        movement: [
          "bunny hop",
          "speed boost"
        ]
      }
    };

    async function loadGames() {
  const gamesGrid = document.getElementById('games-grid');
  
  try {

    const universeId = "2830055467"; 
    const apiUrl = `https://games.roblox.com/v1/games?universeIds=${universeId}`;
    
    let response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`);
    
    if (!response.ok) throw new Error('API request failed');
    
    const data = await response.json();

    renderGames(data); 
    
  } catch (error) {
    console.error(error);

    gamesGrid.innerHTML = '<div class="error-state">无法连接到服务器，请刷新页面</div>';
  }
}

    async function renderGames(data) {
      const gamesGrid = document.getElementById('games-grid');
      
      const games = data.data || [];
      
      if (!games || games.length === 0) {
        gamesGrid.innerHTML = '<div class="error-state">no games found</div>';
        return;
      }

      const gamesWithThumbnails = await Promise.all(games.map(async (game) => {
        try {
          const thumbnailApiUrl = `https://thumbnails.roblox.com/v1/games/icons?universeIds=${game.id}&returnPolicy=PlaceHolder&size=768x432&format=Png&isCircular=false`;
          
          let thumbnailResponse;
          try {
            thumbnailResponse = await fetch(`https://corsproxy.io/?${encodeURIComponent(thumbnailApiUrl)}`);
          } catch (e) {
            try {
              thumbnailResponse = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(thumbnailApiUrl)}`);
            } catch (e2) {
            }
          }
          
          if (thumbnailResponse && thumbnailResponse.ok) {
            const thumbData = await thumbnailResponse.json();
            if (thumbData.data && thumbData.data.length > 0 && thumbData.data[0].imageUrl) {
              game.bannerUrl = thumbData.data[0].imageUrl;
              return game;
            }
          }
        } catch (e) {
        }
        
        game.bannerUrl = 'https://tr.rbxcdn.com/180DAY-6520033018c6162771a61aac035963ef/768/432/Image/Webp/noFilter';
        return game;
      }));

      gamesGrid.innerHTML = gamesWithThumbnails.map(game => {
        const description = game.description ? 
          (game.description.length > 120 ? game.description.substring(0, 120) : game.description) : 
          'no description available';
        
        const cleanDescription = description
          .replace(/\n/g, ' ')
          .replace(/\s+/g, ' ')
          .replace(/[.,;:!?'"()[\]{}]/g, '')
          .trim();
        
        const gameUrl = game.rootPlaceId ? 
          `https://www.roblox.com/games/${game.rootPlaceId}/${encodeURIComponent(game.name || 'game')}` :
          '#';
        
        const creatorName = game.creator?.name || 'Unknown';
        const hasVerified = game.creator?.hasVerifiedBadge || false;
        
        return `
          <article class="game-card glass">
            <div class="game-banner">
              <img src="${game.bannerUrl || 'https://tr.rbxcdn.com/180DAY-6520033018c6162771a61aac035963ef/768/432/Image/Webp/noFilter'}" alt="${escapeHtml((game.name || 'game').toLowerCase())} banner" class="game-banner-image" loading="lazy" />
            </div>
            <div class="game-content">
              <div class="game-header">
                <h3 class="game-title">${escapeHtml((game.name || 'unknown game').toLowerCase())}</h3>
                <span class="pill soft">正常运行</span>
              </div>
              <div class="game-builder">
                <span class="builder-name">游戏创作 ${escapeHtml(creatorName.toLowerCase())}</span>
                ${hasVerified ? '<img src="https://tr.rbxcdn.com/180DAY-df8e7a1023411583234cb7b335f4babc/150/150/Image/Webp/noFilter" alt="verified" class="verified-badge" />' : ''}
              </div>
              <p class="game-description">${escapeHtml(cleanDescription.toLowerCase().replace(/[.,;:!?'"()[\]{}]/g, ''))}</p>
              <div class="game-features-preview">
                <span class="feature-tag">更新日期:2026年1月12日</span>
                <span class="feature-tag">支持电脑</span>
                <span class="feature-tag">支持手机</span>
              </div>
              <div class="game-actions">
                <a href="${gameUrl}" target="_blank" rel="noreferrer" class="btn secondary">跳转游戏</a>
                <button class="btn primary" onclick="showGameFeatures('flick')">查看功能</button>
              </div>
            </div>
          </article>
        `;
      }).join('');
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function showGameFeatures(gameId) {
      const modal = document.getElementById('features-modal');
      const modalTitle = document.getElementById('modal-game-title');
      const modalBody = document.getElementById('modal-body');
      const game = gameFeatures[gameId];

      if (!game) return;

      modalTitle.textContent = gameId + ' features';
      
      let html = '';
      for (const [category, features] of Object.entries(game)) {
        const shownFeatures = features.slice(0, 3);
        const remainingCount = features.length - shownFeatures.length;
        const categoryName = category === 'visual' ? 'visuals' : category;
        
        html += `
          <div class="feature-category">
            <h3 class="category-title">${categoryName}</h3>
            <ul class="feature-items">
              ${shownFeatures.map(f => `<li>${f.toLowerCase()}</li>`).join('')}
            </ul>
          </div>
        `;
      }
      
      modalBody.innerHTML = html;
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    function closeGameFeatures() {
      const modal = document.getElementById('features-modal');
      modal.style.display = 'none';
      document.body.style.overflow = '';
    }

    document.getElementById('features-modal').addEventListener('click', (e) => {
      if (e.target.id === 'features-modal') {
        closeGameFeatures();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeGameFeatures();
      }
    });

    loadGames();
  </script>
</body>
</html>
